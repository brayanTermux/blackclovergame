<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Black Clover Idle - Turbo (com Admin)</title>
<style>
  :root{
    --bg-1:#07070a; --bg-2:#121217;
    --accent:#d4af37; --muted:#cfc7b4; --card:#1b1b1f;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; font-family:Inter,Segoe UI,Arial,sans-serif;
    background:linear-gradient(180deg,var(--bg-1),var(--bg-2)); color:var(--muted);
    display:flex; align-items:flex-start; justify-content:center; padding:20px;
  }
  .app{ width:980px; max-width:96vw; display:grid; grid-template-columns:380px 1fr; gap:18px; }

  .panel{ background:linear-gradient(180deg,#0f0f11,#17171a); border:2px solid rgba(212,175,55,0.12);
    border-radius:14px; padding:16px; position:relative; }
  .title{ display:flex; align-items:center; gap:12px; margin-bottom:8px; }
  .title h1{ margin:0; color:var(--accent); font-size:20px; text-shadow:0 2px 6px #000; }
  #manaLarge{ font-size:22px; color:#fff; margin-bottom:8px; }

  .grimorio-wrap{ position:relative; display:flex; align-items:center; justify-content:center;
    background:linear-gradient(180deg,#111,#0c0c0c); border-radius:12px; padding:14px; border:1px solid rgba(255,255,255,0.03); overflow:hidden; }
  #grimorio{ width:200px; height:200px; cursor:pointer; user-select:none; transform-origin:center center; transition:transform .08s ease; filter:drop-shadow(0 8px 18px rgba(0,0,0,0.6)); }
  #grimorio:active{ transform:scale(.96); }

  .info-row{ display:flex; gap:10px; margin-top:10px; align-items:center; justify-content:space-between; }
  .stat{ background:var(--card); padding:8px 10px; border-radius:8px; min-width:120px; text-align:center; border:1px solid rgba(255,255,255,0.03); }
  .muted{ color:#bdb5a0; font-size:13px; }

  #upgrades{ margin-top:14px; display:flex; flex-direction:column; gap:8px; max-height:360px; overflow:auto; padding-right:4px; }
  .upgrade{ display:flex; gap:10px; align-items:center; background:linear-gradient(180deg,#141416,#1a1a1e); border-radius:10px; padding:8px; border:1px solid rgba(212,175,55,0.06); }
  .sprite{ width:56px; height:56px; border-radius:8px; background:#0b0b0d; display:flex; align-items:center; justify-content:center; font-size:26px; color:var(--accent); }
  .u-body{ flex:1; }
  .u-title{ font-weight:700; color:#fff; }
  .u-sub{ font-size:13px; color:#bfb49a; }
  .u-actions{ display:flex; flex-direction:column; gap:6px; align-items:flex-end; }
  .btn{ background:transparent; border:1px solid rgba(212,175,55,0.12); padding:6px 10px; border-radius:8px; color:var(--accent); cursor:pointer; font-weight:700; }
  .btn:active{ transform:scale(.98); }
  .btn.secondary{ background:rgba(255,255,255,0.02); color:var(--muted); border-color:rgba(255,255,255,0.03); }

  .side{ display:flex; flex-direction:column; gap:12px; }
  .card{ background:linear-gradient(180deg,#0f0f11,#151517); padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.03); }

  .center{text-align:center;} .big{ font-size:20px; color:var(--accent); font-weight:800; } .small{ font-size:13px;color:#cfc7b4; }

  #prestige{ display:flex; gap:8px; align-items:center; justify-content:space-between; margin-top:8px; }
  .danger{ background:#2b0a0a; color:#ffbaba; border:1px solid rgba(255,0,0,0.08); }

  /* admin panel */
  #adminPanel{ position:fixed; right:18px; top:18px; width:320px; max-width:90vw; z-index:9999; display:none; }
  #adminPanel .card{ padding:12px; background:linear-gradient(180deg,#0b0b0d,#161616); border:1px solid rgba(212,175,55,0.14); box-shadow:0 8px 30px rgba(0,0,0,0.6); }

  label{ font-size:13px; color:#cfc7b4; display:block; margin-bottom:6px; }
  input[type="text"], input[type="number"]{ width:100%; padding:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:rgba(255,255,255,0.02); color:var(--muted); }

  #fx{ position:absolute; left:0; top:0; pointer-events:none; }
  #upgrades::-webkit-scrollbar{ width:8px } #upgrades::-webkit-scrollbar-thumb{ background: rgba(255,255,255,0.04); border-radius:6px }
  footer{ text-align:center; margin-top:8px; font-size:12px; color:#9d957f; }
  @media(max-width:880px){ .app{ grid-template-columns:1fr; } #adminPanel{ position:static; margin-top:12px; } }
</style>
</head>
<body>
<div class="app">
  <div class="panel">
    <div class="title">
      <h1>Black Clover Idle - Turbo</h1>
      <div style="margin-left:auto" class="muted">Grim√≥rio Lend√°rio: <span id="prestigeCount">0</span></div>
    </div>

    <div id="manaLarge">Mana: <strong id="manaText">0</strong></div>

    <div class="grimorio-wrap" id="grimWrap" style="position:relative;">
      <canvas id="fx"></canvas>
      <img id="grimorio" src="https://i.imgur.com/HtZfE4F.png" alt="Grim√≥rio">
    </div>

    <div class="info-row">
      <div class="stat"><div class="muted">Mana / Click</div><div id="mpc" style="font-weight:800">1</div></div>
      <div class="stat"><div class="muted">Mana / s</div><div id="mps" style="font-weight:800">0</div></div>
      <div class="stat"><div class="muted">Multiplicador</div><div id="mult" style="font-weight:800">1x</div></div>
    </div>

    <div id="upgrades"></div>
    <footer>Salvamento autom√°tico ‚óè Pressione <strong>M</strong> para abrir o painel Admin</footer>
  </div>

  <div class="side">
    <div class="card center">
      <div class="small">Total de cliques</div>
      <div class="big" id="clicks">0</div>
      <div style="margin-top:8px;">
        <button class="btn" id="buy10">Comprar x10</button>
        <button class="btn secondary" id="buyMax">Comprar M√°x</button>
      </div>
    </div>

    <div class="card">
      <div class="small">Prest√≠gio (Grim√≥rio Lend√°rio)</div>
      <div style="display:flex; align-items:center; justify-content:space-between; margin-top:8px;">
        <div>
          <div class="big" id="prestigeGain">+0</div>
          <div class="small">Cada 10.000 mana = 1 ponto</div>
        </div>
        <div>
          <button class="btn danger" id="doPrestige">Prestigiar (Reset)</button>
        </div>
      </div>
      <div style="margin-top:10px;" class="small">Prest√≠gio atual: <strong id="prestigeTotal">0</strong> ‚Äî multiplicador permanente: <strong id="prestigeMult">1.0x</strong></div>
    </div>

    <div class="card">
      <div class="small">Config / Save</div>
      <div style="display:flex; gap:8px; margin-top:8px;">
        <button class="btn secondary" id="resetSoft">Resetar upgrades</button>
        <button class="btn secondary" id="resetAll">Resetar tudo</button>
      </div>
      <div style="margin-top:8px;" class="small">Auto-save a cada 2s. Estado gravado no navegador.</div>
    </div>
  </div>
</div>

<!-- admin panel -->
<div id="adminPanel">
  <div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <strong style="color:var(--accent)">Painel Admin</strong>
      <button class="btn secondary" id="closeAdmin">Fechar</button>
    </div>
    <div style="margin-top:10px;" class="small">Senha fixa (no c√≥digo). Aten√ß√£o: uso apenas para debug/adm.</div>

    <div style="margin-top:10px;">
      <label>Adicionar Mana</label>
      <div style="display:flex; gap:8px;">
        <input type="number" id="adminAddMana" value="1000" />
        <button class="btn" id="adminDoAdd">+ Add</button>
      </div>
    </div>

    <div style="margin-top:10px;">
      <label>Dar Prestige</label>
      <div style="display:flex; gap:8px;">
        <input type="number" id="adminAddPrest" value="1" />
        <button class="btn" id="adminDoPrest">Adicionar</button>
      </div>
    </div>

    <div style="margin-top:10px;">
      <label>Libera todos upgrades</label>
      <div style="display:flex; gap:8px;">
        <button class="btn" id="adminUnlock">Unlock All</button>
        <button class="btn secondary" id="adminMaxAll">Dar qty x100</button>
      </div>
    </div>

    <div style="margin-top:10px;">
      <label>Multiplicar Mana/Click (tempor√°rio)</label>
      <div style="display:flex; gap:8px;">
        <input type="number" id="adminMult" value="10" />
        <button class="btn" id="adminApplyMult">Aplicar x</button>
      </div>
    </div>

    <div style="margin-top:12px;">
      <label>A√ß√µes de Reset</label>
      <div style="display:flex; gap:8px;">
        <button class="btn danger" id="adminResetKeepPrest">Resetar (keep prestige)</button>
        <button class="btn danger" id="adminResetAll">Resetar Tudo</button>
      </div>
    </div>

  </div>
</div>

<script>
/* ================== CONFIG ================== */
// senha fixa (modifique se quiser)
const adminPassword = "2006";
const SAVE_KEY = "bc_idle_v2";

/* ================== STATE ================== */
const state = {
  mana: 0,
  clicks: 0,
  mpc: 1,
  prestige: 0,
  prestigeMultiplier: 1,
  upgrades: [
    { id:'asta', name:'Asta', base:50, cost:50, mps:1, qty:0, sprite:'üó°Ô∏è' },
    { id:'yuno', name:'Yuno', base:200, cost:200, mps:5, qty:0, sprite:'üå™Ô∏è' },
    { id:'noelle', name:'Noelle', base:1000, cost:1000, mps:20, qty:0, sprite:'üíß' },
    { id:'gauche', name:'Gauche', base:6000, cost:6000, mps:120, qty:0, sprite:'üî™' },
    { id:'luck', name:'Luck', base:25000, cost:25000, mps:600, qty:0, sprite:'‚ö°' },
    { id:'yami', name:'Yami', base:100000, cost:100000, mps:5000, qty:0, sprite:'üêÇ' },
  ],
  tempMultipliers: { mpc:1 } // tempor√°rio via admin
};

/* ================== UI REFS ================== */
const manaText = document.getElementById('manaText');
const mpcEl = document.getElementById('mpc');
const mpsEl = document.getElementById('mps');
const multEl = document.getElementById('mult');
const upgradesContainer = document.getElementById('upgrades');
const clicksEl = document.getElementById('clicks');
const prestigeCount = document.getElementById('prestigeCount');
const prestigeGainEl = document.getElementById('prestigeGain');
const prestigeTotalEl = document.getElementById('prestigeTotal');
const prestigeMultEl = document.getElementById('prestigeMult');

const btnBuy10 = document.getElementById('buy10');
const btnBuyMax = document.getElementById('buyMax');
const btnPrestige = document.getElementById('doPrestige');
const btnResetSoft = document.getElementById('resetSoft');
const btnResetAll = document.getElementById('resetAll');

const grim = document.getElementById('grimorio');
const fxCanvas = document.getElementById('fx');
const grimWrap = document.getElementById('grimWrap');

/* admin refs */
const adminPanel = document.getElementById('adminPanel');
const closeAdmin = document.getElementById('closeAdmin');
const adminDoAdd = document.getElementById('adminDoAdd');
const adminAddMana = document.getElementById('adminAddMana');
const adminUnlock = document.getElementById('adminUnlock');
const adminMaxAll = document.getElementById('adminMaxAll');
const adminDoPrest = document.getElementById('adminDoPrest');
const adminAddPrest = document.getElementById('adminAddPrest');
const adminApplyMult = document.getElementById('adminApplyMult');
const adminMult = document.getElementById('adminMult');
const adminResetKeepPrest = document.getElementById('adminResetKeepPrest');
const adminResetAll = document.getElementById('adminResetAll');

/* ================== CANVAS FX ================== */
function resizeFX(){ fxCanvas.width = grimWrap.clientWidth; fxCanvas.height = grimWrap.clientHeight; fxCanvas.style.width = fxCanvas.width+'px'; fxCanvas.style.height = fxCanvas.height+'px'; }
window.addEventListener('resize', resizeFX);
resizeFX();
const fxCtx = fxCanvas.getContext('2d');
let particles = [];
function spawnParticles(x,y,count=18){
  for(let i=0;i<count;i++){
    const a = Math.random()*Math.PI*2;
    const s = 1 + Math.random()*2;
    particles.push({
      x, y,
      vx: Math.cos(a)*(1+Math.random()*4),
      vy: Math.sin(a)*(1+Math.random()*4)-2,
      life: 60 + Math.random()*30,
      size: 6*Math.random()+2,
      color: `hsl(${Math.floor(Math.random()*50)+30},80%,60%)`
    });
  }
}
function updateParticles(){
  fxCtx.clearRect(0,0,fxCanvas.width,fxCanvas.height);
  for(let i=particles.length-1;i>=0;i--){
    const p = particles[i];
    p.x += p.vx; p.y += p.vy; p.vy += 0.12; p.life--;
    fxCtx.globalAlpha = Math.max(0, p.life/80);
    fxCtx.fillStyle = p.color;
    fxCtx.beginPath(); fxCtx.arc(p.x,p.y,p.size,0,Math.PI*2); fxCtx.fill();
    if(p.life<=0) particles.splice(i,1);
  }
  fxCtx.globalAlpha = 1;
}
setInterval(updateParticles, 1000/60);

/* ================== SAVE / LOAD ================== */
function saveState(){
  try{ const s = JSON.stringify(state); localStorage.setItem(SAVE_KEY, s); }catch(e){ console.warn('save failed',e); }
}
function loadState(){
  try{
    const s = localStorage.getItem(SAVE_KEY);
    if(!s) return;
    const parsed = JSON.parse(s);
    state.mana = parsed.mana || 0; state.clicks = parsed.clicks || 0;
    state.prestige = parsed.prestige || 0; state.prestigeMultiplier = 1 + (state.prestige * 0.1);
    if(parsed.upgrades && Array.isArray(parsed.upgrades)){
      parsed.upgrades.forEach(us=>{
        const u = state.upgrades.find(x=>x.id===us.id);
        if(u){ u.qty = us.qty || 0; u.cost = us.cost || u.base; }
      });
    }
  }catch(e){ console.warn('load failed', e); }
}
loadState();

/* ================== UI RENDER ================== */
function calcMPS(){ let total=0; state.upgrades.forEach(u=> total += u.mps * u.qty); return total * state.prestigeMultiplier; }
function calcMPC(){ return state.mpc * state.prestigeMultiplier * (state.tempMultipliers.mpc || 1); }
function formatNumber(n){
  if(n >= 1e9) return (n/1e9).toFixed(2)+'B';
  if(n >= 1e6) return (n/1e6).toFixed(2)+'M';
  if(n >= 1e3) return (n/1e3).toFixed(2)+'k';
  return Math.floor(n).toString();
}
function updateUI(){
  manaText.innerText = Math.floor(state.mana).toLocaleString();
  mpcEl.innerText = formatNumber(calcMPC());
  mpsEl.innerText = formatNumber(calcMPS()) + '/s';
  multEl.innerText = state.prestigeMultiplier.toFixed(2) + 'x';
  clicksEl.innerText = state.clicks.toLocaleString();
  prestigeCount.innerText = state.prestige.toLocaleString();
  prestigeTotalEl.innerText = state.prestige.toLocaleString();
  prestigeMultEl.innerText = state.prestigeMultiplier.toFixed(2)+'x';
  const gain = Math.floor(state.mana / 10000);
  prestigeGainEl.innerText = '+'+gain;
  // upgrades list
  upgradesContainer.innerHTML = '';
  state.upgrades.forEach((u, idx)=>{
    if(typeof u.cost === 'undefined') u.cost = u.base;
    const el = document.createElement('div'); el.className = 'upgrade';
    el.innerHTML = `
      <div class="sprite">${u.sprite}</div>
      <div class="u-body">
        <div class="u-title">${u.name} <span style="font-size:12px;color:#bfb49a">x${u.qty}</span></div>
        <div class="u-sub">${u.mps} mana/s cada ‚Ä¢ Custo: <strong>${formatNumber(u.cost)}</strong></div>
      </div>
      <div class="u-actions">
        <div style="display:flex; gap:6px;">
          <button class="btn" data-idx="${idx}" data-buy="1">Comprar</button>
          <button class="btn secondary" data-idx="${idx}" data-buy="10">x10</button>
        </div>
        <div style="font-size:12px;color:#9f947a; margin-top:6px;">Rendimento: ${formatNumber(u.mps * u.qty)}/s</div>
      </div>
    `;
    upgradesContainer.appendChild(el);
  });
}

/* ================== BUY LOGIC ================== */
function buyUpgradeIndex(idx, qty=1){
  const u = state.upgrades[idx]; if(!u) return;
  let bought=0;
  for(let i=0;i<qty;i++){
    if(state.mana >= u.cost){
      state.mana -= u.cost; u.qty++; bought++;
      u.cost = Math.floor(u.cost * 1.18);
    } else break;
  }
  if(bought>0){ updateUI(); spawnParticles(fxCanvas.width*0.5, fxCanvas.height*0.4, 8); saveState(); }
}
function buyMax(idx){
  const u = state.upgrades[idx]; if(!u) return;
  let bought=0;
  while(state.mana >= u.cost){
    state.mana -= u.cost; u.qty++; bought++;
    u.cost = Math.floor(u.cost * 1.18);
    if(bought > 100000) break;
  }
  if(bought>0){ updateUI(); saveState(); spawnParticles(fxCanvas.width*0.5, fxCanvas.height*0.4, 14); }
}

/* delegation */
upgradesContainer.addEventListener('click',(ev)=>{
  const btn = ev.target.closest('button'); if(!btn) return;
  const idx = Number(btn.dataset.idx); const buy = Number(btn.dataset.buy || 1);
  if(btn.dataset.buy == '10') buyUpgradeIndex(idx, 10); else buyUpgradeIndex(idx, 1);
});

/* quick buy buttons */
btnBuy10.addEventListener('click', ()=> { for(let i=0;i<state.upgrades.length;i++){ buyUpgradeIndex(i,10); break; }});
btnBuyMax.addEventListener('click', ()=> { for(let i=0;i<state.upgrades.length;i++){ buyMax(i); }});

/* ================== CLICK / MPS ================== */
grim.addEventListener('click',(e)=>{
  const gained = calcMPC();
  state.mana += gained;
  state.clicks++;
  spawnParticles(e.offsetX + 40, e.offsetY + 40, 22);
  playClickTone();
  updateUI();
  saveState();
});
setInterval(()=>{ const perSec = calcMPS(); state.mana += perSec/5; updateUI(); }, 200);
setInterval(saveState, 2000);

/* ================== PRESTIGE ================== */
btnPrestige.addEventListener('click', ()=>{
  const gain = Math.floor(state.mana/10000);
  if(gain <= 0){ alert('Voc√™ precisa de pelo menos 10.000 mana para prestigiar.'); return; }
  if(!confirm(`Prestigiar ir√° resetar mana e upgrades, mas voc√™ ganhar√° +${gain} Grim√≥rios Lend√°rios. Confirmar?`)) return;
  state.prestige += gain; state.prestigeMultiplier = 1 + (state.prestige * 0.1);
  state.mana = 0; state.clicks = 0;
  state.upgrades.forEach(u=>{ u.qty = 0; u.cost = u.base; });
  updateUI(); saveState();
});

/* resets */
btnResetSoft.addEventListener('click', ()=>{ if(!confirm('Resetar upgrades? (mana e prestige ser√£o preservados)')) return; state.upgrades.forEach(u=>{u.qty=0;u.cost=u.base}); updateUI(); saveState(); });
btnResetAll.addEventListener('click', ()=>{ if(!confirm('Resetar tudo? Isso apagar√° o save e prestige.')) return; localStorage.removeItem(SAVE_KEY); location.reload(); });

/* ================== SIMPLE AUDIO ================== */
function playClickTone(){ try{ const ctx = new (window.AudioContext || window.webkitAudioContext)(); const o = ctx.createOscillator(); const g = ctx.createGain(); o.type='sine'; o.frequency.value = 700 + Math.random()*200; g.gain.value = 0.05; o.connect(g); g.connect(ctx.destination); o.start(); o.stop(ctx.currentTime + 0.06); }catch(e){} }

/* ================== ADMIN PANEL LOGIC ================== */
function openAdminPanel(){ adminPanel.style.display = 'block'; }
function closeAdminPanel(){ adminPanel.style.display = 'none'; }

// open prompt via M key
window.addEventListener('keydown',(e)=>{
  if(e.key.toLowerCase() === 'm'){
    const p = prompt("Senha Admin:");
    if(p === adminPassword){ openAdminPanel(); } else if(p!==null){ alert('Senha incorreta'); }
  }
});
// close button
closeAdmin.addEventListener('click', closeAdminPanel);

// admin actions
adminDoAdd.addEventListener('click', ()=>{
  const amount = Number(adminAddMana.value) || 0; state.mana += amount; updateUI(); saveState(); spawnParticles(fxCanvas.width/2, fxCanvas.height/2, 30);
});
adminUnlock.addEventListener('click', ()=> {
  state.upgrades.forEach(u=>{ u.qty = Math.max(u.qty,1); u.cost = Math.floor(u.base * 1.5); });
  updateUI(); saveState(); alert('Todos os upgrades liberados (qty m√≠nimo 1).');
});
adminMaxAll.addEventListener('click', ()=> {
  state.upgrades.forEach(u=>{ u.qty += 100; u.cost = Math.floor(u.base * Math.pow(1.18,u.qty)); });
  updateUI(); saveState(); alert('Adicionados +100 qty a cada upgrade.');
});
adminDoPrest.addEventListener('click', ()=>{
  const add = Math.floor(Number(adminAddPrest.value) || 0);
  if(add <= 0) return alert('Valor inv√°lido');
  state.prestige += add; state.prestigeMultiplier = 1 + (state.prestige * 0.1);
  updateUI(); saveState(); alert('Prest√≠gio adicionado.');
});
adminApplyMult.addEventListener('click', ()=>{
  const m = Number(adminMult.value) || 1; state.tempMultipliers.mpc = m; updateUI(); alert(`Multiplicador tempor√°rio de MPC aplicado: x${m}`);
});
adminResetKeepPrest.addEventListener('click', ()=>{
  if(!confirm('Resetar jogo mas manter prestige?')) return;
  state.mana = 0; state.clicks = 0; state.upgrades.forEach(u=>{u.qty=0; u.cost=u.base}); updateUI(); saveState(); alert('Reset realizado (prestige mantido).');
});
adminResetAll.addEventListener('click', ()=>{
  if(!confirm('Resetar tudo (apagar save e prestige)?')) return;
  localStorage.removeItem(SAVE_KEY); location.reload();
});

/* ================== INIT ================== */
updateUI();
window.addEventListener('load', ()=> spawnParticles(fxCanvas.width/2, fxCanvas.height/2, 28) );

/* small UI refresh */
setInterval(updateUI, 500);
</script>
</body>
</html>
